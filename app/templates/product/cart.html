<!-- app/templates/product/cart.html -->

{% extends "base.html" %}

{% block title %}TeaAsia - Cart{% endblock %}

{% block page_content %}
<a href="/product/products" class="btn btn-large btn-primary">Keep Shopping</a>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Product Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        {%if cart %}
        {% for order in cart %}
        <tr>
            <td>{{ order[0] }}</td>
            <td>${{ order[2] }}</td>
            <td>{{ order[1] }}</td>
            <td>${{ order[3] }}</td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
            <td>No items in cart.</td>
        </tr>
        {% endif %}
    </tbody>
</table>

<div id="paypal-button"></div>

<script src="https://www.paypalobjects.com/api/checkout.js"></script>

<script>
    var CREATE_PAYMENT_URL  = '/product/payment';
    var EXECUTE_PAYMENT_URL = '/product/execute';

    paypal.Button.render({

        env: 'sandbox', // Or 'sandbox'

        commit: true, // Show a 'Pay Now' button
        
	    style: {
	        size: 'responsive', //small,big
	        color: 'gold',
	        shape: 'pill',
	        label: 'checkout'
	    },
	    
        payment: function() {
            return paypal.request.post(CREATE_PAYMENT_URL).then(function(data) {
                return data.paymentID;
            });
        },

        onAuthorize: function(data) {
            return paypal.request.post(EXECUTE_PAYMENT_URL, {
                paymentID: data.paymentID,
                payerID:   data.payerID
            }).then(function(res) {

                console.log(res.success)
                // The payment is complete!
                // You can now show a confirmation message to the customer
            });
        }

    }, '#paypal-button');
</script>
{% endblock %}
