<!-- app/templates/product/cart.html -->

{% extends "base.html" %}

{% block title %}TeaAsia - Cart{% endblock %}

{% block page_content %}
<a href="/product/clean" class="btn btn-large btn-primary">Clean</a>
<table class="table table-striped">
    <thead>
        <tr>
            <th></th>
            <th>Product Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        {%if cart %}
        {% for order in cart %}
        <tr>
        	<td><a href="/product/remove_from_cart/{{ order[0] }}" class="glyphicon glyphicon-trash"></a></td>
            <td>{{ order[0] }}</td>
            <td>${{ order[2] }}</td>
            <td>{{ order[1] }}</td>
            <td>${{ order[3] }}</td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
            <td>No items in cart.</td>
        </tr>
        {% endif %}
    </tbody>
</table>

<div id="paypal-button"></div>

<script src="https://www.paypalobjects.com/api/checkout.js"></script>

<script>
    paypal.Button.render({
    
        env: 'sandbox', // Optional: specify 'sandbox' environment
        
        commit: true, // Show a 'Pay Now' button
        
	    style: {
	        size: 'responsive', //small,big
	        color: 'gold',
	        shape: 'pill',
	        label: 'checkout'
	    },
        
    
        payment: function(resolve, reject) {
               
            var CREATE_PAYMENT_URL = '/product/payment';
                
            paypal.request.post(CREATE_PAYMENT_URL)
                .then(function(data) { resolve(data.paymentID); })
                .catch(function(err) { reject(err); });
        },

        onAuthorize: function(data) {
        
            // Note: you can display a confirmation page before executing
            
            var EXECUTE_PAYMENT_URL = '/product/execute';

            paypal.request.post(EXECUTE_PAYMENT_URL,
                    { paymentID: data.paymentID, payerID: data.payerID })
                    
                .then(function(data) { /* Go to a success page */ })
                .catch(function(err) { /* Go to an error page  */ });
        }

    }, '#paypal-button');
</script>

{% endblock %}
